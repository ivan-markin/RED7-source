/**
 * UI Initiative Stories Slider 1.0.0
 *
 * Instagram-like Stories Slider Made With Swiper
 *
 * https://uiinitiative.com
 *
 * Copyright 2022-2023 UI Initiative
 *
 * Released under the UI Initiative Regular License
 *
 * Released on: February 13, 2023
 */

!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(e="undefined"!=typeof globalThis?globalThis:e||self).createStoriesSlider=i()}(this,(function(){"use strict";return function(e,i={}){const t=e.querySelector(".swiper"),{autoplayDuration:s=5e3,Swiper:n,EffectCube:r,onSlidesIndexesChange:a,onAutoplayStart:d,onAutoplayStop:o}=i;let l,c,{enabled:p=!0}=i,u=0;const m=[];let f,v,h,b,g,y,E,x;const A=(e,i)=>{const t=m.indexOf(e);let n=void 0===i?s:i,r=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);const a=e.slides.eq(e.activeIndex).find("video")[0];return Number.isNaN(r)&&a&&(r=1e3*a.duration),!Number.isNaN(r)&&r>0&&void 0===i&&(n=r),E=n,e.storiesSliderAutoplayTimeout=setTimeout((()=>{if(e.isEnd){if(u!==t)return;l.isEnd||l.slideNext()}else e.slideNext()}),n),d&&d(e),n},T=e=>{clearTimeout(e.storiesSliderAutoplayTimeout),o&&o(e)},w=e=>{T(e);const i=e.slides.eq(e.activeIndex).find("video")[0];i&&(cancelAnimationFrame(c),i.pause());const t=E||s;let n=parseInt(e.slides[e.activeIndex].getAttribute("data-duration"),10);if(Number.isNaN(n)&&(n=void 0),!n&&i&&(n=1e3*i.duration),E=t-((new Date).getTime()-y),e.isEnd&&E<0)return;E<0&&(E=0);const r=1-E/(n||s),a=e.$el.find(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`);a.children("span").remove(),a.append(`<span style="transform:translateX(${100*r-100}%)"></span>`)},S=e=>{T(e),A(e),y=(new Date).getTime(),e.$el.find(".stories-slider-pagination-bullet-current").removeClass("stories-slider-pagination-bullet-current");const i=e.$el.find(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`),t=e.slides.eq(e.activeIndex).find("video")[0];if(t){t.currentTime=0;try{c=requestAnimationFrame((()=>{t.play()}))}catch(e){}}e.slides.find("video").forEach((e=>{e!==t&&(e.currentTime=0,cancelAnimationFrame(c),e.pause())})),m.filter(((e,i)=>i!==u)).forEach((e=>{e.$el.find("video").forEach((e=>{cancelAnimationFrame(c),e.pause()}))})),i.prevAll().addClass("stories-slider-pagination-bullet-viewed").children("span").remove(),i.prevAll().append("<span></span>"),i.nextAll().removeClass("stories-slider-pagination-bullet-viewed stories-slider-pagination-bullet-current").children("span").remove(),i.nextAll().append("<span></span>"),i.removeClass("stories-slider-pagination-bullet-viewed").addClass("stories-slider-pagination-bullet-current").children("span").remove(),i.append("<span></span>"),i[0].clientWidth,i.children("span").transition(`${E}ms`).transform("translateX(0%)"),a&&(cancelAnimationFrame(f),f=requestAnimationFrame((()=>{a(u,e.activeIndex)})))};return(()=>{const i=()=>{e.classList.add("stories-slider-perspective")},s=()=>{e.classList.remove("stories-slider-perspective")};l=new n(t,{modules:void 0!==r?[r]:[],effect:"cube",speed:500,threshold:5,cubeEffect:{shadow:!1},observer:!0,on:{transitionStart(){s()},sliderFirstMove(){s()},transitionEnd(){i()},init(e){e.params.resistanceRatio=.5,i()},slideChange(){const e=m[u];u=l.activeIndex;const i=m[u];T(e),A(i),S(i)}}})})(),e.querySelectorAll(".swiper .swiper").forEach(((e,i)=>{const t=new n(e,{speed:1,nested:!0,allowTouchMove:!1,observer:!0,on:{touchStart(e){v=!0,x=!1,h=(new Date).getTime(),b=setTimeout((()=>{x=!0,w(e)}),200)},touchEnd(e){clearTimeout(b),u===i&&v&&(g=(new Date).getTime()-h,x&&(e=>{if(e.isEnd&&E<0)return;y=(new Date).getTime(),A(e,E);const i=e.slides.eq(e.activeIndex).find("video")[0];if(i)try{c=requestAnimationFrame((()=>{i.play()}))}catch(e){}e.$el.find(`.stories-slider-pagination-bullet:nth-child(${e.activeIndex+1})`).children("span").transform("translateX(0%)").transition(`${E}ms`)})(e),x=!1,v=!1)},init(e){p&&(u!==i?T(e):requestAnimationFrame((()=>{S(e)})))},slideChange(e){S(e)}}});(e=>{const i=e.querySelectorAll(".swiper-slide"),t=document.createElement("div");t.classList.add("stories-slider-pagination");for(let e=0;e<i.length;e+=1){const e=document.createElement("div");e.classList.add("stories-slider-pagination-bullet"),e.appendChild(document.createElement("span")),t.appendChild(e)}e.appendChild(t)})(e),((e,i)=>{e.querySelectorAll(".swiper-slide").forEach((e=>{const t=document.createElement("div"),s=document.createElement("div");t.classList.add("stories-slider-button","stories-slider-button-prev"),s.classList.add("stories-slider-button","stories-slider-button-next"),e.appendChild(t),e.appendChild(s),t.addEventListener("click",(()=>{g>200||(i.isBeginning?l.slidePrev():i.slidePrev())})),s.addEventListener("click",(()=>{g>200||(i.isEnd?l.slideNext():i.slideNext())}))}))})(e,t),m.push(t)})),{el:e,mainSwiper:l,subSwipers:m,destroy:()=>{l&&l.destroy&&l.destroy(),m.forEach((e=>{T(e),e.$el.find(".stories-slider-pagination, .stories-slider-pagination-bullet").remove(),(e=>{e.slides.find(".stories-slider-button").remove()})(e),e.destroy&&e.destroy()}))},slideTo:(e,i)=>{if(l&&l.slideTo&&!l.destroyed&&l.slideTo(e,0),void 0!==i){const t=m[e];t.slideTo&&!t.destroyed&&(t.activeIndex===i?S(t):t.slideTo(i,0))}},enable:()=>{p||m.forEach(((e,i)=>{i===u&&S(e)}))},disable:()=>{p=!1,m.forEach(((e,i)=>{e.$el.find("video").forEach((e=>{cancelAnimationFrame(c),e.pause()})),i===u?w(e):T(e)}))}}}}));
//# sourceMappingURL=stories-slider.min.js.map